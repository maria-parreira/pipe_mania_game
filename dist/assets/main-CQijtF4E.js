(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const n={rows:7,cols:9,cellSize:50,selectedCell:{row:0,col:0}},w=c=>{const e={};for(const[t,r]of Object.entries(c)){const s=new Image;s.src=r,e[t]=s}return e},m={vertical:"src/assets/pipes/vertical.png",horizontal:"src/assets/pipes/horizontal.png",cross:"src/assets/pipes/cross.png",curvedBottomRight:"src/assets/pipes/curvedBottomRight.png",curvedBottomLeft:"src/assets/pipes/curvedBottomLeft.png",curvedTopRight:"src/assets/pipes/curvedTopRight.png",curvedTopLeft:"src/assets/pipes/curvedTopLeft.png",bgcell:"src/assets/bgcell.png",curvedTopBL66e:"src/assets/waterflow/curvedTop/BL/66e.png",vertical100:"src/assets/waterflow/vertical/100.png",vertical66c:"src/assets/waterflow/vertical/66c.png",vertical66b:"src/assets/waterflow/vertical/66b.png",vertical33c:"src/assets/waterflow/vertical/33c.png",horizontal100:"src/assets/waterflow/horizontal/100.png",horizontal66e:"src/assets/waterflow/horizontal/66e.png",horizontal66d:"src/assets/waterflow/horizontal/66d.png",vertical33b:"src/assets/waterflow/vertical/33b.png",horizontal33e:"src/assets/waterflow/horizontal/33e.png",horizontal33d:"src/assets/waterflow/horizontal/33d.png",curvedTopBR100:"src/assets/waterflow/curvedTop/BR/100.png",curvedTopBR66d:"src/assets/waterflow/curvedTop/BR/66d.png",curvedTopBR66b:"src/assets/waterflow/curvedTop/BR/66b.png",curvedTopBR33d:"src/assets/waterflow/curvedTop/BR/33d.png",curvedTopBR33b:"src/assets/waterflow/curvedTop/BR/33b.png",curvedTopBL100:"src/assets/waterflow/curvedTop/BL/100.png",curvedTopBL66b:"src/assets/waterflow/curvedTop/BL/66b.png",curvedTopBL33e:"src/assets/waterflow/curvedTop/BL/33e.png",curvedTopBL33b:"src/assets/waterflow/curvedTop/BL/33b.png",curvedBottomTL100:"src/assets/waterflow/curvedBottom/TL/100.png",curvedBottomTL66e:"src/assets/waterflow/curvedBottom/TL/66e.png",curvedBottomTL66c:"src/assets/waterflow/curvedBottom/TL/66c.png",curvedBottomTL33e:"src/assets/waterflow/curvedBottom/TL/33e.png",curvedBottomTL33c:"src/assets/waterflow/curvedBottom/TL/33c.png",curvedBottomTL:"src/assets/waterflow/curvedBottom/TL",curvedBottom:"src/assets/waterflow/curvedBottom",cross100V:"src/assets/waterflow/cross/100V.png",cross66e:"src/assets/waterflow/cross/66e.png",cross100H:"src/assets/waterflow/cross/100H.png",cross33e:"src/assets/waterflow/cross/33e.png",cross33d:"src/assets/waterflow/cross/33d.png",curvedBottomTR33c:"src/assets/waterflow/curvedBottom/TR/33c.png",curvedBottomTR33d:"src/assets/waterflow/curvedBottom/TR/33d.png",curvedBottomTR66c:"src/assets/waterflow/curvedBottom/TR/66c.png",curvedBottomTR66d:"src/assets/waterflow/curvedBottom/TR/66d.png",curvedBottomTR100:"src/assets/waterflow/curvedBottom/TR/100.png",blockedcell:"src/assets/blockedcell.png"},a=w({curvedTopBL66e:"src/assets/waterflow/curvedTop/BL/66e.png",vertical100:"src/assets/waterflow/vertical/100.png",vertical66c:"src/assets/waterflow/vertical/66c.png",vertical66b:"src/assets/waterflow/vertical/66b.png",vertical33c:"src/assets/waterflow/vertical/33c.png",horizontal100:"src/assets/waterflow/horizontal/100.png",horizontal66e:"src/assets/waterflow/horizontal/66e.png",horizontal66d:"src/assets/waterflow/horizontal/66d.png",vertical33b:"src/assets/waterflow/vertical/33b.png",horizontal33e:"src/assets/waterflow/horizontal/33e.png",horizontal33d:"src/assets/waterflow/horizontal/33d.png",curvedTopBR100:"src/assets/waterflow/curvedTop/BR/100.png",curvedTopBR66d:"src/assets/waterflow/curvedTop/BR/66d.png",curvedTopBR66b:"src/assets/waterflow/curvedTop/BR/66b.png",curvedTopBR33d:"src/assets/waterflow/curvedTop/BR/33d.png",curvedTopBR33b:"src/assets/waterflow/curvedTop/BR/33b.png",curvedTopBL100:"src/assets/waterflow/curvedTop/BL/100.png",curvedTopBL66b:"src/assets/waterflow/curvedTop/BL/66b.png",curvedTopBL33e:"src/assets/waterflow/curvedTop/BL/33e.png",curvedTopBL33b:"src/assets/waterflow/curvedTop/BL/33b.png",curvedBottomTL100:"src/assets/waterflow/curvedBottom/TL/100.png",curvedBottomTL66e:"src/assets/waterflow/curvedBottom/TL/66e.png",curvedBottomTL66c:"src/assets/waterflow/curvedBottom/TL/66c.png",curvedBottomTL33e:"src/assets/waterflow/curvedBottom/TL/33e.png",curvedBottomTL33c:"src/assets/waterflow/curvedBottom/TL/33c.png",curvedBottomTL:"src/assets/waterflow/curvedBottom/TL",curvedBottom:"src/assets/waterflow/curvedBottom",cross100V:"src/assets/waterflow/cross/100V.png",cross66e:"src/assets/waterflow/cross/66e.png",cross100H:"src/assets/waterflow/cross/100H.png",cross33e:"src/assets/waterflow/cross/33e.png",cross33d:"src/assets/waterflow/cross/33d.png",curvedBottomTR33c:"src/assets/waterflow/curvedBottom/TR/33c.png",curvedBottomTR33d:"src/assets/waterflow/curvedBottom/TR/33d.png",curvedBottomTR66c:"src/assets/waterflow/curvedBottom/TR/66c.png",curvedBottomTR66d:"src/assets/waterflow/curvedBottom/TR/66d.png",curvedBottomTR100:"src/assets/waterflow/curvedBottom/TR/100.png"}),d=w(m),p=w({startup:"src/assets/start/startUp.png",startdown:"src/assets/start/startDown.png",startleft:"src/assets/start/startLeft.png",startright:"src/assets/start/startRight.png"});class B{image;type;containsWater;constructor(){this.type=this.getRandomPipeType(),this.image=this.getImageByType(this.type),this.containsWater=!1}getRandomPipeType(){const e=["horizontal","curvedBottomRight","curvedBottomLeft","cross","vertical","curvedTopRight","curvedTopLeft"],t=Math.floor(Math.random()*e.length);return e[t]}getImageByType(e){switch(e){case"horizontal":return d.horizontal;case"vertical":return d.vertical;case"curvedBottomRight":return d.curvedBottomRight;case"curvedBottomLeft":return d.curvedBottomLeft;case"curvedTopRight":return d.curvedTopRight;case"curvedTopLeft":return d.curvedTopLeft;case"cross":return d.cross;default:throw new Error("invalid pipe type")}}draw(e,t,r,s){const o=()=>{e.save(),e.strokeStyle="blue",e.lineWidth=2,e.strokeRect(t,r,s,s),e.drawImage(this.image,t,r,s,s),e.restore()};this.image.complete?o():this.image.onload=o}drawWaterPipe(e,t,r,s){let o;switch(this.type){case"horizontal":o=[a.horizontal33,a.horizontal66,a.horizontal100],this.drawFillingPipe(e,t,r,s,o);break;case"vertical":o=[a.vertical33,a.vertical66,a.vertical100];break;case"curvedBottomRight":o=[a.curvedTopBR33,a.curvedTopBR66,a.curvedTopBR100],this.drawFillingPipe(e,t,r,s,o);break;case"curvedBottomLeft":o=[a.curvedBottomTR33,a.curvedBottomTR66,a.curvedBottomTR100],this.drawFillingPipe(e,t,r,s,o);break;case"curvedTopRight":o=[a.curvedTopBL33,a.curvedTopBL66,a.curvedTopBL100],this.drawFillingPipe(e,t,r,s,o);break;case"curvedTopLeft":o=[a.curvedTopBL33,a.curvedTopBL66,a.curvedTopBL100],this.drawFillingPipe(e,t,r,s,o);break;case"cross":o=[a.cross33H,a.cross66H,a.cross100H],this.drawFillingPipe(e,t,r,s,o);break;default:throw new Error("invalid pipe type")}}drawFillingPipe(e,t,r,s,o){let i=0;const l=()=>{i<o.length&&(e.drawImage(o[i],t,r,s,s),i++,setTimeout(l,500))};l()}fillWithWater(){this.containsWater=!0}getPossibleConnectionsToAdjacentPipes(){switch(this.type){case"horizontal":return["east","west"];case"vertical":return["north","south"];case"curvedBottomRight":return["north","east","west"];case"curvedBottomLeft":return["south","east","west"];case"cross":return["north","south","east","west"];default:return[]}}}const T=()=>{const c=[];return{enqueue(e){c.push(e)},dequeue(){return c.shift()},size(){return c.length},isEmpty(){return c.length===0},getItems(){return c},peek(){return c[0]}}};class P{queue=T();constructor(e=5){for(let t=0;t<e;t++)this.queue.enqueue(this.generatePipe())}drawPipeQueue(e,t,r){this.queue.getItems().forEach((i,l)=>{const u=r+l*60;i.draw(e,t,u,50)})}generatePipe(){return new B}getFirstPipe(){return this.queue.peek()}removeFirst(){this.queue.dequeue()}addLast(e){this.queue.enqueue(e)}}class L{canvas;ctx;grid;pipeQueue=new P(5);selectedPipe=null;isRunning=!0;countdown=10;timerInterval=null;score=0;constructor(e,t,r,s){this.canvas=e,this.ctx=e.getContext("2d"),this.grid=s,this.addEventListeners(),this.startGame(this.ctx)}startGame(e){this.startCountdown(e),this.runGameLoop()}startCountdown(e){this.timerInterval=window.setInterval(()=>{this.countdown>0?this.countdown--:(this.stopCountdown(),this.startWaterFlow(this.ctx))},1e3)}stopCountdown(){this.timerInterval!==null&&(clearInterval(this.timerInterval),this.timerInterval=null)}startWaterFlow(e){}runGameLoop(){const e=()=>{this.isRunning&&(this.updateGame(),this.drawGame(),requestAnimationFrame(e))};requestAnimationFrame(e)}updateGame(){this.countdown===0&&this.startWaterFlow(this.ctx)}drawGame(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.grid.draw(this.ctx),this.grid.drawStartPipe(this.ctx,50),this.pipeQueue.drawPipeQueue(this.ctx,10,150),this.drawHUD()}drawHUD(){this.ctx.font="20px Arial",this.ctx.fillStyle="black",this.ctx.fillText(`Time until water: ${this.countdown}s`,10,20),this.ctx.fillText(`Score: ${this.score}`,10,50)}addEventListeners(){this.canvas.addEventListener("click",this.handleGridClick.bind(this))}handleGridClick(e){const t=e.clientX-this.grid.getStartX(this.ctx),r=e.clientY-this.grid.getStartY(this.ctx),s=Math.floor(t/n.cellSize),o=Math.floor(r/n.cellSize);o>=0&&o<n.rows&&s>=0&&s<n.cols&&(this.grid.getGridCell(o,s).isBlocked()||(this.handlePipeSelection(),this.selectedPipe&&(this.grid.setPipeInCell(o,s,this.selectedPipe),this.score+=10)))}handlePipeSelection(){const e=this.pipeQueue.getFirstPipe();if(e){this.selectedPipe=e,this.pipeQueue.removeFirst();const t=this.pipeQueue.generatePipe();this.pipeQueue.addLast(t)}}}class R{row;col;size;pipe;blocked;startPipe=null;constructor(e,t,r,s){this.row=e,this.col=t,this.size=r,this.pipe=null,this.blocked=s}getPipe(){return this.pipe}setPipe(e){this.pipe=e}isBlocked(){return this.blocked}setBlocked(e){this.blocked=e}fillPipeWithWater(e){this.pipe?.fillWithWater(),this.pipe?.drawWaterPipe(e,this.row,this.col,this.size)}getRow(){return this.row}getCol(){return this.col}}class b{startImage;constructor(){this.startImage=this.getStartImage()}getStartImage(){const e=Object.keys(p),t=Math.floor(Math.random()*e.length);return this.startImage=p[e[t]],this.startImage}drawStartPipe(e,t,r,s){e.drawImage(this.startImage,t,r,s,s)}getStartPipeOrientation(){return this.startImage===p.startup?"Up":this.startImage===p.startdown?"Down":this.startImage===p.startleft?"Left":this.startImage===p.startright?"Right":"invalid pipe type"}}class C{rows;cols;cellSize;cells;cellWithStartPipe=null;startPoint=null;image=d.bgcell;constructor(e,t,r){this.rows=e,this.cols=t,this.cellSize=r,this.cells=[],this.initializeGrid()}initializeGrid(){const e=this.generateBlockedIndices();this.cells=this.createGrid(e)}generateBlockedIndices(){const e=this.rows*this.cols,t=Math.floor(e*.1),r=new Set;for(;r.size<t;){const s=Math.floor(Math.random()*e);r.add(s)}return r}createGrid(e){debugger;const t=[];for(let r=0;r<this.rows;r++){const s=[];for(let o=0;o<this.cols;o++){const i=r*this.cols+o,l=e.has(i);s.push(new R(r,o,this.cellSize,l))}t.push(s)}return t}getStartX(e){return e.canvas.getBoundingClientRect().x+this.getBorderIntervalX(e)}getBorderIntervalX(e){return(e.canvas.width-this.cols*this.cellSize)/2}getStartY(e){return e.canvas.getBoundingClientRect().y+this.getBorderIntervalY(e)}getBorderIntervalY(e){return(e.canvas.height-this.rows*this.cellSize)/2}getCellPosition(e,t,r){const{borderIntervalX:s,borderIntervalY:o}=this.getBorderIntervals(r);return this.getGridCoordinate(e,t,s,o)}getBorderIntervals(e){const t=this.getBorderIntervalX(e),r=this.getBorderIntervalY(e);return{borderIntervalX:t,borderIntervalY:r}}getGridCoordinate(e,t,r,s){const o=r+t*this.cellSize,i=s+e*this.cellSize;return{x:o,y:i}}setPipeInCell(e,t,r){debugger;const s=this.cells[e][t];s&&!s.isBlocked()&&s.setPipe(r)}draw(e){e.clearRect(0,0,this.cols*this.cellSize,this.rows*this.cellSize);for(let t=0;t<this.rows;t++)for(let r=0;r<this.cols;r++)this.drawCellWithImages(e,t,r)}drawCellWithImages(e,t,r){const s=this.cells[t][r],{x:o,y:i}=this.getCellPosition(t,r,e);s?.isBlocked()?e.drawImage(d.blockedcell,o,i,this.cellSize,this.cellSize):s?.getPipe()?s.getPipe()?.draw(e,o,i,this.cellSize):this.drawCell(e,o,i,this.cellSize),e.strokeStyle="yellow",e.lineWidth=3,e.strokeRect(o,i,this.cellSize,this.cellSize)}drawCell(e,t,r,s){this.image.complete?e.drawImage(this.image,t,r,s,s):this.image.onload=()=>{e.drawImage(this.image,t,r,s,s)}}drawStartPipe(e,t){this.cellWithStartPipe||this.initializeStartPipe(e);const{x:r,y:s}=this.cellWithStartPipe;this.startPoint?.drawStartPipe(e,r,s,t),this.blockCellAtStartPipeCoordinates(e)}initializeStartPipe(e){let t=!1;for(;!t;){const{randomRow:r,randomCol:s}=this.generateRandomPipePosition();this.cellWithStartPipe={x:s,y:r},this.areStartPipeCoordinatesValid(r,s,e)&&(t=!0)}this.startPoint||(this.startPoint=new b)}blockCellAtStartPipeCoordinates(e){const t=this.getCellStartPipeCoordinates(e);if(t){const{row:r,col:s}=t;this.cells[r][s].setBlocked(!0)}}areStartPipeCoordinatesValid(e,t,r){if(e===this.rows-1||this.cells[e][t]?.isBlocked())return!1;const s=this.getNeighboringCells(e,t);for(const{row:h,col:g}of s)if(this.isCellBlocked(h,g))return this.tryMoveStartPipe(e,t,r);const{borderIntervalX:o,borderIntervalY:i}=this.getBorderIntervals(r),{x:l,y:u}=this.getGridCoordinate(e,t,o,i);return this.cellWithStartPipe={x:l,y:u},!0}tryMoveStartPipe(e,t,r){const s=[{row:e-1,col:t},{row:e+1,col:t},{row:e,col:t-1},{row:e,col:t+1}];for(const{row:o,col:i}of s)if(this.isValidCell(o,i)&&!this.isCellBlocked(o,i)&&this.getNeighboringCells(o,i).every(({row:h,col:g})=>!this.isCellBlocked(h,g))){const{borderIntervalX:h,borderIntervalY:g}=this.getBorderIntervals(r),{x:v,y:f}=this.getGridCoordinate(o,i,h,g);return this.cellWithStartPipe={x:v,y:f},!0}return!1}getNeighboringCells(e,t){return[{row:-1,col:0},{row:1,col:0},{row:0,col:-1},{row:0,col:1}].map(({row:s,col:o})=>({row:e+s,col:t+o})).filter(({row:s,col:o})=>this.isValidCell(s,o))}isValidCell(e,t){return e>=0&&e<this.rows&&t>=0&&t<this.cols}isCellBlocked(e,t){return this.isValidCell(e,t)?this.cells[e][t]?.isBlocked():!0}generateRandomPipePosition(){const e=this.cells.length,t=this.cells[0].length,r=Math.floor(Math.random()*e),s=Math.floor(Math.random()*t);return{randomRow:r,randomCol:s}}updateAdjacentCellWithWater(e,t,r){const s=this.hasAdjacentConnections(t,r);if(s){const{row:o,col:i}=s;this.cells[o][i].fillPipeWithWater(e)}}hasAdjacentConnections(e,t){const s=this.cells[e][t].getPipe()?.getPossibleConnectionsToAdjacentPipes()||[];for(const o of s){const i=this.getAdjacentCellPipe(e,t,o);if(i){const[l,u]=i,h=this.cells[l][u];if(h&&h.getPipe())return{row:i[0],col:i[1]}}}return null}getAdjacentCellPipe(e,t,r){switch(r){case"north":return e>0?[e-1,t]:null;case"south":return e<this.cells.length-1?[e+1,t]:null;case"east":return t<this.cells[0].length-1?[e,t+1]:null;case"west":return t>0?[e,t-1]:null;default:return null}}getGridCell(e,t){return this.cells[e][t]}getCellStartPipeCoordinates(e){if(this.cellWithStartPipe){const{x:t,y:r}=this.cellWithStartPipe,s=Math.floor((t-this.getBorderIntervalX(e))/this.cellSize);return{row:Math.floor((r-this.getBorderIntervalY(e))/this.cellSize),col:s}}return null}}document.addEventListener("DOMContentLoaded",()=>{const c=document.getElementById("gameCanvas");c.width=n.cols*n.cellSize+200,c.height=n.rows*n.cellSize+200;const e=document.getElementById("pipe-queue"),t=document.getElementById("game-status"),r=new C(n.rows,n.cols,n.cellSize);new L(c,e,t,r).startGame()});
